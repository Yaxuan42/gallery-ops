// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client"
  output   = "../lib/generated/prisma"
}

datasource db {
  provider = "sqlite"
}

// ============ Auth ============

model User {
  id           String   @id @default(cuid())
  email        String   @unique
  name         String?
  passwordHash String   @map("password_hash")
  role         String   @default("admin")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  @@map("users")
}

// ============ Product (SPU) ============

model Product {
  id              String   @id @default(cuid())
  nameZh          String   @map("name_zh")
  nameEn          String   @map("name_en")
  category        String
  subcategory     String?
  model           String?
  descriptionZh   String?  @map("description_zh")
  descriptionEn   String?  @map("description_en")
  designer        String?
  designerSeries  String?  @map("designer_series")
  priceRangeLow   Float?   @map("price_range_low")
  priceRangeHigh  Float?   @map("price_range_high")
  collectionValue String?  @map("collection_value")
  slug            String   @unique
  featured        Boolean  @default(false)
  sortOrder       Int      @default(0)
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  items           Item[]
  images          ProductImage[]

  @@map("products")
}

model ProductImage {
  id        String   @id @default(cuid())
  productId String   @map("product_id")
  product   Product  @relation(fields: [productId], references: [id], onDelete: Cascade)
  url       String
  alt       String?
  sortOrder Int      @default(0)
  isPrimary Boolean  @default(false) @map("is_primary")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("product_images")
}

// ============ Item (SKU) ============

model Item {
  id               String   @id @default(cuid())
  skuCode          String   @unique @map("sku_code")
  productId        String?  @map("product_id")
  product          Product? @relation(fields: [productId], references: [id])
  name             String
  nameEn           String?  @map("name_en")
  recommendation   String?
  notes            String?
  manufacturer     String?
  era              String?
  material         String?
  dimensions       String?
  conditionGrade   String?  @map("condition_grade")
  designerSeries   String?  @map("designer_series")

  supplierId       String?  @map("supplier_id")
  supplier         Supplier? @relation(fields: [supplierId], references: [id])

  listPrice        Float?   @map("list_price")
  sellingPrice     Float?   @map("selling_price")

  shippingCostUsd  Float?   @map("shipping_cost_usd")
  shippingCostRmb  Float?   @map("shipping_cost_rmb")
  customsFees      Float?   @map("customs_fees")
  importDuties     Float?   @map("import_duties")
  purchasePriceUsd Float?   @map("purchase_price_usd")
  purchasePriceRmb Float?   @map("purchase_price_rmb")
  totalCost        Float?   @map("total_cost")

  status           String   @default("IN_STOCK")
  showOnWebsite    Boolean  @default(true) @map("show_on_website")
  slug             String   @unique

  createdAt        DateTime @default(now()) @map("created_at")
  updatedAt        DateTime @updatedAt @map("updated_at")

  images           ItemImage[]
  salesOrderItems  SalesOrderItem[]

  @@map("items")
}

model ItemImage {
  id        String   @id @default(cuid())
  itemId    String   @map("item_id")
  item      Item     @relation(fields: [itemId], references: [id], onDelete: Cascade)
  url       String
  alt       String?
  sortOrder Int      @default(0)
  isPrimary Boolean  @default(false) @map("is_primary")
  createdAt DateTime @default(now()) @map("created_at")

  @@map("item_images")
}

// ============ Customer ============

model Customer {
  id          String   @id @default(cuid())
  name        String
  type        String   @default("INDIVIDUAL")
  source      String?
  phone       String?
  email       String?
  wechat      String?
  address     String?
  notes       String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  salesOrders SalesOrder[]

  @@map("customers")
}

// ============ Sales Order ============

model SalesOrder {
  id            String   @id @default(cuid())
  orderNumber   String   @unique @map("order_number")
  customerId    String   @map("customer_id")
  customer      Customer @relation(fields: [customerId], references: [id])
  orderDate     DateTime @map("order_date")
  deliveryDate  DateTime? @map("delivery_date")
  totalAmount   Float    @map("total_amount")
  totalCost     Float    @map("total_cost")
  grossProfit   Float    @map("gross_profit")
  status        String   @default("PENDING")
  paymentDate   DateTime? @map("payment_date")
  shippingAddr  String?  @map("shipping_addr")
  notes         String?
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  items         SalesOrderItem[]

  @@map("sales_orders")
}

model SalesOrderItem {
  id           String     @id @default(cuid())
  salesOrderId String     @map("sales_order_id")
  salesOrder   SalesOrder @relation(fields: [salesOrderId], references: [id], onDelete: Cascade)
  itemId       String     @map("item_id")
  item         Item       @relation(fields: [itemId], references: [id])
  price        Float
  cost         Float

  @@map("sales_order_items")
}

// ============ Supplier ============

model Supplier {
  id          String   @id @default(cuid())
  name        String
  code        String?  @unique
  country     String
  contactName String?  @map("contact_name")
  email       String?
  phone       String?
  wechat      String?
  address     String?
  status      String   @default("ACTIVE")
  tags        String?
  notes       String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  items       Item[]

  @@map("suppliers")
}

// ============ Website Support ============

model HeroSlide {
  id        String   @id @default(cuid())
  imageUrl  String   @map("image_url")
  titleZh   String?  @map("title_zh")
  titleEn   String?  @map("title_en")
  linkUrl   String?  @map("link_url")
  sortOrder Int      @default(0)
  active    Boolean  @default(true)
  createdAt DateTime @default(now()) @map("created_at")
  @@map("hero_slides")
}

model ContactInquiry {
  id        String   @id @default(cuid())
  name      String?
  email     String
  phone     String?
  subject   String?
  message   String
  itemRef   String?  @map("item_ref")
  read      Boolean  @default(false)
  createdAt DateTime @default(now()) @map("created_at")
  @@map("contact_inquiries")
}

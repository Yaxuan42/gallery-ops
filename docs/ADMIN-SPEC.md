# 管理后台功能规格 (Admin Specification)

## 1. 认证系统

- **登录页** (`/login`)：邮箱 + 密码表单
- **方案**：NextAuth.js v5 Credentials Provider + bcrypt 密码哈希
- **会话**：JWT 策略，24 小时过期
- **中间件**：`middleware.ts` 保护所有非 `/login` 路由
- **初始账号**：通过 seed 脚本创建 (admin@gallery.local / Gallery2025!)

---

## 2. 布局框架

```
┌─────────────────────────────────────────────────┐
│  Topbar: 画廊名称 | 搜索 | 用户菜单(退出登录)      │
├──────────┬──────────────────────────────────────┤
│          │                                      │
│ Sidebar  │         Main Content                 │
│          │                                      │
│ ○ 仪表盘  │                                      │
│ ○ 商品    │                                      │
│ ○ 库存    │                                      │
│ ○ 客户    │                                      │
│ ○ 销售单  │                                      │
│ ○ 采购单  │                                      │
│ ○ 供应商  │                                      │
│ ○ 媒体    │                                      │
│          │                                      │
└──────────┴──────────────────────────────────────┘
```

- 侧边栏可折叠（移动端默认收起）
- 面包屑导航显示当前位置
- 操作反馈用 Toast 通知

### 目录结构

```
apps/admin/
├── app/
│   ├── login/page.tsx
│   ├── (dashboard)/
│   │   ├── layout.tsx           # 侧边栏 + 顶栏布局
│   │   ├── page.tsx             # 仪表盘首页
│   │   ├── products/            # 商品目录管理
│   │   │   ├── page.tsx         # 列表
│   │   │   ├── new/page.tsx     # 新建
│   │   │   └── [id]/page.tsx    # 编辑
│   │   ├── inventory/           # 库存单件管理
│   │   ├── customers/           # 客户管理
│   │   ├── sales-orders/        # 销售订单管理
│   │   ├── purchase-orders/     # 采购订单管理
│   │   ├── suppliers/           # 供应商管理
│   │   └── media/               # 图片媒体管理
│   └── api/
│       ├── auth/[...nextauth]/route.ts
│       ├── upload/route.ts
│       └── dashboard/stats/route.ts
├── components/
│   ├── layout/                  # Sidebar, Topbar, Breadcrumb
│   ├── dashboard/               # KPI 卡片, 图表组件
│   ├── forms/                   # 各实体表单组件
│   ├── tables/                  # DataTable + 列定义
│   └── ui/                      # ImageUploader, StatusBadge 等
└── lib/
    ├── auth.ts                  # NextAuth 配置
    └── actions/                 # Server Actions (每实体一个文件)
```

---

## 3. 仪表盘 (`/`)

### KPI 卡片（顶部一行，4 列）

| 卡片     | 数据源                        | 展示                  |
| -------- | ----------------------------- | --------------------- |
| 本月营收 | SalesOrder.totalAmount (当月) | 金额 + 环比增长%      |
| 累计毛利 | SalesOrder.grossProfit (累计) | 金额 + 毛利率%        |
| 库存数量 | Item count by status          | 现货 N 件 / 在途 N 件 |
| 活跃客户 | Customer count (有订单)       | 数量 + 本月新增       |

### 图表区域（2x2 网格）

| 图表             | 类型           | 数据                                |
| ---------------- | -------------- | ----------------------------------- |
| 月度营收 vs 成本 | 柱状图 (Bar)   | 近 12 个月 totalAmount vs totalCost |
| 毛利率趋势       | 折线图 (Line)  | 近 12 个月 grossProfit/totalAmount  |
| 库存品类分布     | 饼图 (Pie)     | Item count by designerSeries        |
| 库存状态占比     | 环形图 (Donut) | Item count by status                |

### 最近订单表格（底部）

- 显示最近 10 笔销售订单：单号、客户、日期、金额、毛利、状态

---

## 4. 商品目录管理 (`/products`)

### 列表页

| 列         | 内容                                |
| ---------- | ----------------------------------- |
| 缩略图     | 主图 (ProductImage where isPrimary) |
| 中文名     | nameZh，可点击进入编辑              |
| 英文名     | nameEn                              |
| 分类       | category / subcategory              |
| 设计师系列 | designerSeries                      |
| 库存数     | 关联 Item 数量                      |
| 价格区间   | priceRangeLow ~ priceRangeHigh      |
| 操作       | 编辑 / 删除                         |

**筛选器**：分类下拉、设计师系列下拉、文本搜索
**排序**：名称、创建时间、库存数

### 创建/编辑表单

| 字段         | 类型         | 验证                                                |
| ------------ | ------------ | --------------------------------------------------- |
| 中文名 \*    | 文本输入     | 必填                                                |
| 英文名 \*    | 文本输入     | 必填                                                |
| 分类 \*      | 下拉选择     | 必填，选项：椅子/桌子/沙发/收纳/灯具/屏风/凳子/其他 |
| 小类         | 文本输入     |                                                     |
| 型号         | 文本输入     |                                                     |
| 设计师       | 文本输入     |                                                     |
| 设计师系列   | 下拉选择     | 选项：Eames/昌迪加尔/其他                           |
| 中文描述     | 富文本       |                                                     |
| 英文描述     | 富文本       |                                                     |
| 市场价格区间 | 两个数字输入 |                                                     |
| 收藏价值说明 | 长文本       |                                                     |
| 首页精选     | 开关         |                                                     |
| 图片         | 拖拽上传区   | 支持多图，可排序，可设主图                          |

---

## 5. 库存单件管理 (`/inventory`)

### 列表页

| 列         | 内容                                          |
| ---------- | --------------------------------------------- |
| 缩略图     | 主图                                          |
| 名称       | name，可点击编辑                              |
| 所属商品   | Product.nameZh (链接)                         |
| 状态       | 彩色徽章：现货(绿)/在途(黄)/已售(灰)/预留(蓝) |
| 设计师系列 | designerSeries                                |
| 供应商     | Supplier.name                                 |
| 标价       | listPrice (RMB)                               |
| 总成本     | totalCost (RMB)                               |
| 成色       | conditionGrade                                |
| 操作       | 编辑 / 删除                                   |

**筛选器**：状态多选、设计师系列、供应商、分类
**排序**：名称、标价、成本、创建时间

### 创建/编辑表单

| 字段组   | 字段                                                     | 说明     |
| -------- | -------------------------------------------------------- | -------- |
| 基本信息 | 名称\*、英文名、备注、所属商品(下拉)、设计师系列(下拉)   |          |
| 物品详情 | 厂家、年代、材质、尺寸、成色等级(A/B/C/D)                |          |
| 供应商   | 供应商(搜索下拉)                                         |          |
| 定价     | 标价(RMB)、售价(RMB)                                     |          |
| 成本明细 | 运费USD、运费RMB、清关费、进口关税、采购价USD、采购价RMB |          |
| 总成本   | 自动计算 = 运费RMB + 清关费 + 进口关税 + 采购价RMB       | **只读** |
| 状态     | 状态(下拉)、是否在官网展示(开关)                         |          |
| 图片     | 多图上传、排序、设主图                                   |          |

---

## 6. 客户管理 (`/customers`)

### 列表页

| 列       | 内容                         |
| -------- | ---------------------------- |
| 名称     | name，可点击编辑             |
| 类型     | 彩色徽章：散客/商业空间/画廊 |
| 来源     | source                       |
| 电话     | phone                        |
| 微信     | wechat                       |
| 订单数   | SalesOrder count             |
| 累计消费 | sum(SalesOrder.totalAmount)  |
| 操作     | 编辑 / 删除                  |

### 创建/编辑表单

名称*、类型*(下拉)、来源渠道(下拉：小红书/闲鱼/朋友介绍/老客户/客户介绍)、电话、邮箱、微信、地址、备注

### 详情页

额外展示该客户的历史订单列表

---

## 7. 销售订单管理 (`/sales-orders`)

### 列表页

| 列       | 内容                            |
| -------- | ------------------------------- |
| 单号     | orderNumber，可点击             |
| 客户     | Customer.name                   |
| 下单日期 | orderDate                       |
| 订单总额 | totalAmount (RMB)               |
| 订单成本 | totalCost (RMB)                 |
| 毛利     | grossProfit (RMB)               |
| 毛利率   | grossProfit/totalAmount \* 100% |
| 状态     | 彩色徽章                        |
| 付款日期 | paymentDate                     |
| 操作     | 编辑 / 删除                     |

### 创建/编辑表单

| 字段        | 说明                                                                       |
| ----------- | -------------------------------------------------------------------------- |
| 单号 \*     | 自动生成 SO + 年份 + 序号，可手动修改                                      |
| 客户 \*     | 搜索下拉选择                                                               |
| 下单日期 \* | 日期选择器                                                                 |
| 交货日期    | 日期选择器                                                                 |
| 商品行项    | 动态表格：从库存中选择(筛选状态=现货)，显示名称/标价/实际售价(可编辑)/成本 |
| 订单总额    | 自动计算 = sum(行项售价) **只读**                                          |
| 订单成本    | 自动计算 = sum(行项成本) **只读**                                          |
| 毛利        | 自动计算 = 总额 - 成本 **只读**                                            |
| 状态        | 下拉                                                                       |
| 付款日期    | 日期选择器                                                                 |
| 收货地址    | 文本                                                                       |
| 备注        | 长文本                                                                     |

### 业务逻辑

- 订单状态变为 COMPLETED 时，自动将关联 Item 的 status 更新为 SOLD
- 订单取消时，将关联 Item 的 status 恢复为 IN_STOCK

---

## 8. 采购订单管理 (`/purchase-orders`)

### 列表页

| 列         | 内容            |
| ---------- | --------------- |
| 单号       | orderNumber     |
| 供应商     | Supplier.name   |
| 选货日期   | selectionDate   |
| 合同总额   | contractTotal   |
| 采购总成本 | totalCost       |
| 已售金额   | soldAmount      |
| 待售货值   | pendingValue    |
| 已回款     | recoveredAmount |
| 状态       | 彩色徽章        |
| 操作       | 编辑 / 删除     |

### 创建/编辑表单

包含采购 CSV 中所有字段，按付款节点分组（首付 → 修复期 → 发货尾款）

---

## 9. 供应商管理 (`/suppliers`)

**列表页**：名称、国家（国旗图标）、联系人、邮箱/微信、状态徽章、标签、采购单数

**创建/编辑表单**：名称*、编号、国家*(下拉)、联系人、电话、邮箱、微信、地址、状态、标签(多选芯片)、备注

---

## 10. 媒体管理 (`/media`)

- **网格视图**：所有已上传图片的缩略图
- **筛选**：按实体类型（商品/库存单件）、按上传日期
- **操作**：预览大图、查看关联实体、删除（带级联警告）
- **批量上传**：拖拽多文件上传
